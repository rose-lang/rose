<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="https://raw.githubusercontent.com/rose-lang/rose-icons/efcc218832d65970a47bed597ee11cecd3d1cc3c/svg/plain-rose.svg"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css"
      integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/style.css" />
    <title>Rose</title>
  </head>
  <body>
    <div class="top">
      <img
        height="40px"
        src="https://raw.githubusercontent.com/rose-lang/rose-icons/efcc218832d65970a47bed597ee11cecd3d1cc3c/svg/encircled-rose.svg"
      />
      <span class="name">Rose</span>
      <a
        class="fa fa-github fa-2x"
        href="https://github.com/rose-lang/rose"
      ></a>
    </div>
    <div class="example">
      <pre><code class="language-javascript">import * as rose from "rose";
import { Dual, Real, Vec, add, compile, div, fn, mul, opaque, vjp } from "rose";

const log = opaque([Real], Real, Math.log);
log.jvp = fn([Dual], Dual, ({ re: x, du: dx }) => {
  return { re: log(x), du: div(dx, x) };
});

const pow = opaque([Real, Real], Real, Math.pow);
pow.jvp = fn([Dual, Dual], Dual, ({ re: x, du: dx }, { re: y, du: dy }) => {
  const z = pow(x, y);
  return { re: z, du: mul(add(mul(dx, div(y, x)), mul(dy, log(x))), z) };
});

const Vec2 = Vec(2, Real);
const Mat2 = Vec(2, Vec2);

const f = fn([Vec2], Real, (v) => pow(v[0], v[1]));
const g = fn([Vec2], Vec2, (v) => vjp(f)(v).grad(1));
const h = fn([Vec2], Mat2, (v) => {
  const { grad } = vjp(g)(v);
  return [grad([1, 0]), grad([0, 1])];
});

const funcs = await Promise.all([compile(f), compile(g), compile(h)]);
console.log(funcs.map((func) => func([2, 3])));</code></pre>
    </div>
    <div class="bottom">
      <a href="https://github.com/rose-lang/rose-icons">icons</a> by
      <a href="https://github.com/aatxe">Aaron Weiss</a> /
      <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
